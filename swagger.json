{
  "openapi": "3.0.0",
  "info": {
    "title": "API Gestión DSW",
    "version": "1.0.0",
    "description": "API del sistema de gestión de ventas, stock, empleados, clientes y autenticación."
  },
  "servers": [
    {
      "url": "http://localhost:3500",
      "description": "Servidor Local"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "Empleado": {
        "type": "object",
        "properties": {
          "DNI_CUIL": { "type": "string" },
          "nombre_apellidoEmp": { "type": "string" },
          "contacto": { "type": "string" },
          "sucursal": { "type": "integer" },
          "email": { "type": "string" },
          "password": { "type": "string" },
          "idrol": { "type": "integer" }
        }
      },
      "Producto": {
        "type": "object",
        "properties": {
          "articulo": { "type": "string" },
          "descripcion": { "type": "string" },
          "cantidad": { "type": "integer" },
          "monto": { "type": "number" }
        }
      },
      "Rol": {
        "type": "object",
        "properties": {
          "idrol": { "type": "integer", "description": "ID único del rol." },
          "rol": { "type": "string", "description": "Nombre del rol (ej: admin, vendedor)." }
        },
        "required": ["idrol", "rol"]
      }
    }
  },

  "security": [
    { "bearerAuth": [] }
  ],

  "paths": {
    "/auth/login": {
      "post": {
        "summary": "Iniciar sesión",
        "tags": ["Autenticación"],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string", "example": "user@test.com" },
                  "password": { "type": "string", "example": "123456" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Login exitoso, devuelve token" },
          "401": { "description": "Credenciales incorrectas" }
        }
      }
    },

    "/auth/reset-direct": {
      "post": {
        "summary": "Restablecer contraseña directamente",
        "tags": ["Autenticación"],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string" },
                  "newPassword": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Contraseña actualizada" },
          "404": { "description": "Usuario no encontrado" }
        }
      }
    },

    "/ventas": {
      "get": {
        "summary": "Obtener historial de ventas",
        "tags": ["Ventas"],
        "parameters": [
          { "name": "filtro", "in": "query", "schema": { "type": "string" } },
          { "name": "pagina", "in": "query", "schema": { "type": "integer", "default": 0 } },
          { "name": "limite", "in": "query", "schema": { "type": "integer", "default": 20 } }
        ],
        "responses": {
          "200": { "description": "Lista de ventas paginada" }
        }
      }
    },

    "/ventas/crearVenta": {
      "post": {
        "summary": "Registrar nueva venta",
        "tags": ["Ventas"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "montoTotal": { "type": "number" },
                  "DNIEmpleado": { "type": "string" },
                  "idCliente": { "type": "integer" },
                  "productos": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "idProducto": { "type": "integer" },
                        "cantidadVendida": { "type": "integer" },
                        "subtotal": { "type": "number" }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Venta creada exitosamente" }
        }
      }
    },

    "/detalle_ventas/{idVenta}": {
      "get": {
        "summary": "Detalle de una venta",
        "tags": ["Ventas"],
        "parameters": [
          { "name": "idVenta", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Detalle de productos vendidos" }
        }
      }
    },

    "/stock": {
      "get": {
        "summary": "Listar productos del stock",
        "tags": ["Stock"],
        "parameters": [
          { "name": "producto", "in": "query", "schema": { "type": "string" } },
          { "name": "pagina", "in": "query", "schema": { "type": "integer" } },
          { "name": "limite", "in": "query", "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Lista de productos" }
        }
      },
      "post": {
        "summary": "Crear producto",
        "tags": ["Stock"],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/Producto" }
            }
          }
        },
        "responses": {
          "201": { "description": "Producto creado" }
        }
      }
    },

    "/stock/{id}": {
      "put": {
        "summary": "Actualizar producto",
        "tags": ["Stock"],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/Producto" }
            }
          }
        },
        "responses": {
          "200": { "description": "Producto actualizado" }
        }
      }
    },

    "/stockelim/{id}": {
      "put": {
        "summary": "Cambiar estado del producto (borrado lógico)",
        "tags": ["Stock"],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "estado": { "type": "string", "example": "Disponible" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Estado actualizado" }
        }
      }
    },

    "/clientes": {
      "get": {
        "summary": "Listar clientes",
        "tags": ["Clientes"],
        "parameters": [
          { "name": "nombre", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Lista de clientes" }
        }
      },
      "post": {
        "summary": "Crear cliente",
        "tags": ["Clientes"],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "dni": { "type": "string" },
                  "nombre_apellidoCli": { "type": "string" },
                  "direccion": { "type": "string" },
                  "contacto": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Cliente creado" }
        }
      }
    },

    "/empleados": {
      "get": {
        "summary": "Listar empleados",
        "tags": ["Empleados"],
        "parameters": [
          { "name": "nombre", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Lista de empleados" }
        }
      },
      "post": {
        "summary": "Crear empleado",
        "tags": ["Empleados"],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/Empleado" }
            }
          }
        },
        "responses": {
          "201": { "description": "Empleado creado" }
        }
      }
    },

    "/roles": {
      "get": {
        "summary": "Listar todos los roles",
        "tags": ["Roles"],
        "responses": {
          "200": { 
            "description": "Lista de roles",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Rol"
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Crear un nuevo rol",
        "tags": ["Roles"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/Rol" }
            }
          }
        },
        "responses": {
          "201": { "description": "Rol creado" },
          "400": { "description": "Datos incompletos" }
        }
      }
    },

    "/roles/{id}": {
      "get": {
        "summary": "Obtener rol por ID",
        "tags": ["Roles"],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { 
            "description": "Detalle del rol",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Rol" }
              }
            }
          },
          "404": { "description": "Rol no encontrado" }
        }
      },
      "put": {
        "summary": "Actualizar rol por ID",
        "tags": ["Roles"],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "rol": { "type": "string", "description": "Nombre del rol (ej: admin, vendedor)." }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Rol actualizado" },
          "400": { "description": "Datos incompletos" },
          "404": { "description": "Rol no encontrado para actualizar" }
        }
      },
      "delete": {
        "summary": "Eliminar rol por ID",
        "tags": ["Roles"],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Rol eliminado" },
          "404": { "description": "Rol no encontrado para eliminar" },
          "409": { "description": "No se puede eliminar el rol, ya que está asignado a empleados." }
        }
      }
    },
    
    "/sucursales": {
      "get": {
        "summary": "Listar sucursales",
        "tags": ["Sucursales"],
        "parameters": [
          { "name": "filtro", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Lista de sucursales" }
        }
      }
    }
  }
}